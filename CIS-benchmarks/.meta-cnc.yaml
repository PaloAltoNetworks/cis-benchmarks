name: CIS_NGFW_benchmark
label: CIS NGFW benchmarks

description: |
  Use CIS CSC benchmarks for system validations

type: pan_validation
labels:
  collection:
    - CIS
    - Benchmark
    - Validation

variables:

  - name: app_threat_intervals
    description: interval values used for 4.2 apps threats update interval test
    type_hint: hidden
    default:
      - daily
      - hourly
      - every-30-mins

  - name: wf_file_size_limits
    description: wildfire recommended file size limits
    type_hint: hidden
    default:
      - pe: 16
        apk: 30
        pdf: 3072
        ms-office: 16384
        jar: 5
        flash: 5
        MacOSX: 10
        archive: 50
        linux: 50
        script: 2000

snippets:

  # TODO: determine what to use for doc links: CIS text, IronSkillet, palo docs

  # 1.1.1.1 Syslog logging should be configured
  # TODO: future update to include Panorama/CDL option in the checks
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: system_entry_all_logs
        capture_list: /config/shared/log-settings/system/match-list/entry/filter[text()='All Logs']/../@name
      - name: system_entry_send_syslog_all_logs
        capture_list: /config/shared/log-settings/system/match-list/entry/send-syslog/member/../../@name
        filter_items: item in system_entry_all_logs
      - name: config_entry_all_logs
        capture_list: /config/shared/log-settings/config/match-list/entry/filter[text()='All Logs']/../@name
      - name: config_entry_send_syslog_all_logs
        capture_list: /config/shared/log-settings/config/match-list/entry/send-syslog/member/../../@name
        filter_items: item in config_entry_all_logs
      - name: userid_entry_all_logs
        capture_list: /config/shared/log-settings/userid/match-list/entry/filter[text()='All Logs']/../@name
      - name: userid_entry_send_syslog_all_logs
        capture_list: /config/shared/log-settings/userid/match-list/entry/send-syslog/member/../../@name
        filter_items: item in userid_entry_all_logs
      - name: hipmatch_entry_all_logs
        capture_list: /config/shared/log-settings/hipmatch/match-list/entry/filter[text()='All Logs']/../@name
      - name: hipmatch_entry_send_syslog_all_logs
        capture_list: /config/shared/log-settings/hipmatch/match-list/entry/send-syslog/member/../../@name
        filter_items: item in hipmatch_entry_all_logs
      - name: globalprotect_entry_all_logs
        capture_list: /config/shared/log-settings/globalprotect/match-list/entry/filter[text()='All Logs']/../@name
      - name: globalprotect_entry_send_syslog_all_logs
        capture_list: /config/shared/log-settings/globalprotect/match-list/entry/send-syslog/member/../../@name
        filter_items: item in globalprotect_entry_all_logs
      - name: iptag_entry_all_logs
        capture_list: /config/shared/log-settings/iptag/match-list/entry/filter[text()='All Logs']/../@name
      - name: iptag_entry_send_syslog_all_logs
        capture_list: /config/shared/log-settings/iptag/match-list/entry/send-syslog/member/../../@name
        filter_items: item in iptag_entry_all_logs

  - name: system_logging_configured
    label: 1.1.1.1 Syslog logging should be configured
    test: |
      (
        system_entry_send_syslog_all_logs | length
        and config_entry_send_syslog_all_logs | length
        and userid_entry_send_syslog_all_logs | length
        and hipmatch_entry_send_syslog_all_logs | length
        and globalprotect_entry_send_syslog_all_logs | length
        and iptag_entry_send_syslog_all_logs | length
      )
    fail_message: |
      Benchmark fails based on these log settings:
      {%- if system_entry_send_syslog_all_logs | length == 0 %}
      System
      {%- endif %}
      {%- if config_entry_send_syslog_all_logs | length == 0 %}
      Config
      {%- endif %}
      {%- if userid_entry_send_syslog_all_logs | length == 0 %}
      UserID
      {%- endif %}
      {%- if hipmatch_entry_send_syslog_all_logs | length == 0 %}
      HIP Match
      {%- endif %}
      {%- if globalprotect_entry_send_syslog_all_logs | length == 0 %}
      GlobalProtect
      {%- endif %}
      {%- if iptag_entry_send_syslog_all_logs | length == 0 %}
      IP Tag
      {%- endif %}
    pass_message: |
      Benchmark passes based on these log settings:
      System: {{ system_entry_send_syslog_all_logs }}
      Config: {{ config_entry_send_syslog_all_logs }}
      UserID: {{ config_entry_send_syslog_all_logs }}
      HIP Match: {{ hipmatch_entry_send_syslog_all_logs }}
      GlobalProtect: {{ globalprotect_entry_send_syslog_all_logs }}
      IP Tag: {{ iptag_entry_send_syslog_all_logs }}
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.1.1.2 snmpv3 traps configured
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: system_entry_all_logs
        capture_list: /config/shared/log-settings/system/match-list/entry/filter[text()='All Logs']/../@name
      - name: system_entry_send_snmp_all_logs
        capture_list: /config/shared/log-settings/system/match-list/entry/send-snmptrap/member/../../@name
        filter_items: item in system_entry_all_logs
      - name: config_entry_all_logs
        capture_list: /config/shared/log-settings/config/match-list/entry/filter[text()='All Logs']/../@name
      - name: config_entry_send_snmp_all_logs
        capture_list: /config/shared/log-settings/config/match-list/entry/send-snmptrap/member/../../@name
        filter_items: item in config_entry_all_logs
      - name: userid_entry_all_logs
        capture_list: /config/shared/log-settings/userid/match-list/entry/filter[text()='All Logs']/../@name
      - name: userid_entry_send_snmp_all_logs
        capture_list: /config/shared/log-settings/userid/match-list/entry/send-snmptrap/member/../../@name
        filter_items: item in userid_entry_all_logs
      - name: hipmatch_entry_all_logs
        capture_list: /config/shared/log-settings/hipmatch/match-list/entry/filter[text()='All Logs']/../@name
      - name: hipmatch_entry_send_snmp_all_logs
        capture_list: /config/shared/log-settings/hipmatch/match-list/entry/send-snmptrap/member/../../@name
        filter_items: item in hipmatch_entry_all_logs
      - name: globalprotect_entry_all_logs
        capture_list: /config/shared/log-settings/globalprotect/match-list/entry/filter[text()='All Logs']/../@name
      - name: globalprotect_entry_send_snmp_all_logs
        capture_list: /config/shared/log-settings/globalprotect/match-list/entry/send-snmptrap/member/../../@name
        filter_items: item in globalprotect_entry_all_logs
      - name: iptag_entry_all_logs
        capture_list: /config/shared/log-settings/iptag/match-list/entry/filter[text()='All Logs']/../@name
      - name: iptag_entry_send_snmp_all_logs
        capture_list: /config/shared/log-settings/iptag/match-list/entry/send-snmptrap/member/../../@name
        filter_items: item in iptag_entry_all_logs
      - name: snmpv3_trap_profiles
        capture_list: /config/shared/log-settings/snmptrap/entry/version/v3/../../@name
      - name: logging_snmp_profiles_without_snmpv3
        capture_list: /config/shared/log-settings//match-list/entry/send-snmptrap/member/text()
        filter_items: item not in snmpv3_trap_profiles

  - name: snmp_system_logging_configured
    label: 1.1.1.2 SNMPv3 traps should be configured
    test: |
      (
        system_entry_send_snmp_all_logs | length
        and config_entry_send_snmp_all_logs | length
        and userid_entry_send_snmp_all_logs | length
        and hipmatch_entry_send_snmp_all_logs | length
        and globalprotect_entry_send_snmp_all_logs | length
        and iptag_entry_send_snmp_all_logs | length
        and logging_snmp_profiles_without_snmpv3 | length == 0
      )
    fail_message: |
      Benchmark fails based on these log settings:
      {%- if system_entry_send_snmp_all_logs | length == 0 %}
      System
      {%- endif %}
      {%- if config_entry_send_snmp_all_logs | length == 0 %}
      Config
      {%- endif %}
      {%- if userid_entry_send_snmp_all_logs | length == 0 %}
      UserID
      {%- endif %}
      {%- if hipmatch_entry_send_snmp_all_logs | length == 0 %}
      HIP Match
      {%- endif %}
      {%- if globalprotect_entry_send_snmp_all_logs | length == 0 %}
      GlobalProtect
      {%- endif %}
      {%- if iptag_entry_send_snmp_all_logs | length == 0 %}
      IP Tag
      {%- endif %}
      {%- if logging_snmp_profiles_without_snmpv3 | length %}
      SNMP logging profiles not using version 3: {{ logging_snmp_profiles_without_snmpv3 }}
      {%- endif %}
    pass_message: |
      Benchmark passes based on these log settings:
      System: {{ system_entry_send_snmp_all_logs }}
      Config: {{ config_entry_send_snmp_all_logs }}
      UserID: {{ config_entry_send_snmp_all_logs }}
      HIP Match: {{ hipmatch_send_snmp_all_logs }}
      GlobalProtect: {{ globalprotect_entry_send_snmp_all_logs }}
      IP Tag: {{ iptag_entry_send_snmp_all_logs }}
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.1.2 login banner set
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: login_banner
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/login-banner

  - name: login_banner_set
    label: 1.1.2 Ensure 'Login Banner' is set
    test: login_banner | tag_present('login-banner')
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.1.3 log on high dp load
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: enable_log_high_dp_load
    label: 1.1.3 Ensure 'Enable Log on High DP Load' is enabled
    test: device_setting | element_value('management.enable-log-high-dp-load') == 'yes'
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html#device-setup-management-logging-and-reporting-settings

  # 1.2.1 permitted ip addresses for device management
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: mgmt_permitted_ips
        capture_list: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/permitted-ip/entry/@name

  - name: permitted_ip_addresses_mgmt
    label: 1.2.1 Ensure 'Permitted IP Addresses' is set to those necessary for device management
    test: mgmt_permitted_ips | length
    fail_message: no permitted IP addresses configured for the management interface
    pass_message: permitted IP addresses configured
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.2.2 permitted ip addresses for management profiles
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: profile_permitted_ips
        capture_list: /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile/entry/permitted-ip/../@name
      - name: profile_ssh_enabled
        capture_list: /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile/entry/ssh[text()='yes']/../@name
      - name: profile_https_enabled
        capture_list: /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile/entry/https[text()='yes']/../@name
      - name: profile_snmp_enabled
        capture_list: /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile/entry/snmp[text()='yes']/../@name
      - name: ssh_https_snmp_enabled_profiles_no_ip_list
        capture_expression: |
          profile_ssh_enabled
          + profile_https_enabled
          + profile_snmp_enabled
        filter_items: item not in profile_permitted_ips


  - name: permitted_ip_address_mgmt_profiles
    label: 1.2.2 Ensure 'Permitted IP Addresses' is set for all management profiles where SSH, HTTPS, or SNMP is enabled
    test: ssh_https_snmp_enabled_profiles_no_ip_list | length == 0
    fail_message: |
      network profiles failing this benchmark are
      {% for item in ssh_https_snmp_enabled_profiles_no_ip_list | unique %}
      {{ item }}
      {% endfor %}
    pass_message: all ssh, https, snmp enabled profiles have permitted IP addresses configured
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.2.3 disable http and telnet for mgmt interface
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: mgmt_disable_http
        capture_value: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/service/disable-http/text()
      - name: mgmt_disable_telnet
        capture_value: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/service/disable-telnet/text()

  - name: http_telnet_disabled_mgmt
    label: 1.2.3 Ensure HTTP and Telnet options are disabled for the management interface
    test: |
      (
        mgmt_disable_http != 'no'
        and mgmt_disable_telnet != 'no'
      )
    fail_message: |
      {%- if mgmt_disable_http == 'no' %}
        http management access is not disabled
      {%- endif %}
      {%- if mgmt_disable_telnet == 'no' %}
        telnet management access is not disabled
      {%- end if %}
    pass_message: http and telnet are disable for management interface access
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.2.4 disable http and telnet for mgmt profiles
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: http_enabled_profiles
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile/
          entry/http[text()='yes']/../@name
      - name: telnet_enabled_profiles
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile/
          entry/telnet[text()='yes']/../@name

  - name: http_telnet_disabled_mgmt_profiles
    label: 1.2.4 Ensure HTTP and Telnet options are disabled for all management profiles
    test: |
      (
        http_enabled_profiles | length == 0
        and telnet_enabled_profiles | length == 0
      )
    fail_message: |
      {% if http_disabled_profiles | length %}
        http not disabled for profiles: {{ http_enabled_profiles }}
      {% endif %}
      {% if telnet_enabled_profiles | length %}
        telnet not disabled for profiles: {{ telnet_enabled_profiles }}
      {% endif %}
    pass_message: http and telnet disabled for all management profiles
    documentation_link: https://iron-skillet.readthedocs.io

  # 1.2.5 valid cert set for UI admin intf
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: ssl_profiles
        capture_list: /config/shared/ssl-tls-service-profile/entry/@name

  - name: valid_cert_admin_intf
    label: 1.2.5 Ensure valid certificate is set for browser-based administrator interface
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 1.3.1 enable min password complexity
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_complexity_enabled
        capture_value: /config/mgt-config/password-complexity/enabled/text()

  - name: test_password_complexity_enabled
    label: 1.3.1 Ensure 'Minimum Password Complexity' is enabled
    test: password_complexity_enabled == 'yes'
    fail_message: Minimum Password Complexity is not enabled
    pass_message: Minimum Password Complexity is enabled
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.2 password complexity min length
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_min_length
        capture_value: /config/mgt-config/password-complexity/minimum-length/text()

  - name: test_password_min_length
    label: 1.3.2 Ensure 'Minimum Length' is greater than or equal to 12
    test: password_min_length >= '12'
    fail_message: Minimum length is set to {{ password_min_length }}
    pass_message: Minimum length is set to {{ password_min_length }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.3 password minimum uppercase letters
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_min_uppercase
        capture_value: /config/mgt-config/password-complexity/minimum-uppercase-letters/text()

  - name: test_password_min_uppercase
    label: 1.3.3 Ensure 'Minimum Uppercase Letters' is greater than or equal to 1
    test: password_min_uppercase >= '1'
    fail_message: Minimum Uppercase Letters is set to {{ password_min_length }}
    pass_message: Minimum Uppercase Letters is set to {{ password_min_length }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.4 password complexity min lowercase
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_min_lowercase
        capture_value: /config/mgt-config/password-complexity/minimum-lowercase-letters/text()

  - name: test_password_min_lowercase
    label: 1.3.4 Ensure 'Minimum Lowercase Letters' is greater than or equal to 1
    test: password_min_lowercase >= '1'
    fail_message: Minimum Lowercase Letters is set to {{ password_min_lowercase }}
    pass_message: Minimum Lowercase Letters is set to {{ password_min_lowercase }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.5 password complexity min numeric
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_min_numeric
        capture_value: /config/mgt-config/password-complexity/minimum-numeric-letters/text()

  - name: test_password_min_uppercase
    label: 1.3.5 Ensure 'Minimum Numeric Letters' is greater than or equal to 1
    test: password_min_numeric >= '1'
    fail_message: Minimum Numeric Letters is set to {{ password_min_numeric }}
    pass_message: Minimum Numeric Letters is set to {{ password_min_numeric }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.6 password complexity min specials chars
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_min_special
        capture_value: /config/mgt-config/password-complexity/minimum-special-characters/text()

  - name: test_password_min_special
    label: 1.3.6 Ensure 'Minimum Special Characters' is greater than or equal to 1
    test: password_min_special >= '1'
    fail_message: Minimum Special Characters is set to {{ password_min_special }}
    pass_message: Minimum Special Characters is set to {{ password_min_special }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.7 password complexity change period
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_min_change_period
        capture_value: /config/mgt-config/password-complexity/password-change/expiration-period/text()

  - name: test_password_min_change_period
    label: 1.3.7 Ensure 'Required Password Change Period' is less than or equal to 90 days
    test: password_min_change_period <= '90'
    fail_message: Required Password Change Period is set to {{ password_min_change_period }} days
    pass_message: Required Password Change Period is set to {{ password_min_change_period }} days
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.8 password complexity new password differs by char
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_differs_by_char
        capture_value: /config/mgt-config/password-complexity/new-password-differs-by-characters/text()

  - name: test_password_differs_by_char
    label: 1.3.8 Ensure 'New Password Differs By Characters' is greater than or equal to 3
    test: password_differs_by_char >= '3'
    fail_message: New Password Differs By Characters is set to {{ password_differs_by_char }}
    pass_message: New Password Differs By Characters is set to {{ password_differs_by_char }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.9 password complexity password reuse limit
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_history_count
        capture_value: /config/mgt-config/password-complexity/password-history-count/text()

  - name: test_password_history_count
    label: 1.3.9 Ensure 'Prevent Password Reuse Limit' is set to 24 or more passwords
    test: password_history_count >= '24'
    fail_message: Prevent Password Reuse Limit is set to {{ password_history_count }} passwords
    pass_message: Prevent Password Reuse Limit is set to {{ password_history_count }} passwords
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-minimum-password-complexity

  # 1.3.10 password profiles do not exist
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: password_profiles
        capture_list: /config/mgt-config/password-profile/entry/@name

  - name: test_password_profiles
    label: 1.3.10 Ensure 'Password Profiles' do not exist
    test: password_profiles | length == 0
    fail_message: |
      Password profiles {{ password_profiles }} have been configured.
      If they are used ensure settings are stronger than the password complexity settings
    pass_message: benchmark requirements are met. No password profiles configured.
    documentation_link: https://www.paloaltonetworks.com

  # 1.4.1 admin idle timeout
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: admin_idle_timeout
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/management/idle-timeout/text()

  - name: max_idle_timeout
    label: 1.4.1 Ensure 'Idle timeout' is less than or equal to 10 minutes for device management
    test: admin_idle_timeout <= '10'
    fail_message: Idle Timeout is set to {{ admin_idle_timeout }} minutes
    pass_message: Idle Timeout is set to {{ admin_idle_timeout }} minutes
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-authentication-settings

  # 1.4.2 admin failed attempts and lockout
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: failed_attempts
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/management/
          admin-lockout/failed-attempts/text()
      - name: lockout_time
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/management/
          admin-lockout/lockout-time/text()

  - name: test_failed_attempts_lockout
    label: 1.4.2 Ensure 'Failed Attempts' and 'Lockout Time' for Authentication Profile are properly configured
    test: |
      (
      failed_attempts | length
      and failed_attempts > '0'
      and lockout_time | length
      )
    fail_message: |
      {%- if failed_attempts | length == 0 or failed_attempts == 0 %}
        Failed Attempts not configured or set to unlimited tries
      {%- endif %}
      {%- if lockout_time | length == 0 %}
        Lockout Time is not configured
      {%- endif %}
    pass_message: |
      Failed Attempts set to {{ failed_attempts }} and Lockout Time set to {{ lockout_time }}.
      Check that these are set in accordance with company policy.
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #device-setup-management-authentication-settings

  # 1.5.1 use snmpv3 for polling
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: snmp_version
        capture_object: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/snmp-setting/access-setting/version

  - name: snmpv3_selected
    label: 1.5.1 Ensure 'V3' is selected for SNMP polling
    test: snmp_version | tag_present('v3')
    fail_message: V3 is not selected for SNMP polling
    pass_message: V3 is selected for SNMP polling
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html#device-setup-operations-snmp-setup

  # 1.6.1 Ensure 'Verify Update Server Identity' is enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: verify_server_identiy
        capture_value: |
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/server-verification/text()

  - name: verify_update_service_enabled
    label: 1.6.1 Ensure 'Verify Update Server Identity' is enabled
    test: verify_server_identiy != 'no'
    fail_message: Verify Update Server Idenity is not enabled
    pass_message: Verify Update Server Idenity is enabled
    documentation_link: https://www.paloaltonetworks.com

  # 1.6.2 Ensure redundant NTP servers are configured appropriately
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: ntp_servers
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/ntp-servers

  - name: redundant_ntp_servers
    label: 1.6.2 Ensure redundant NTP servers are configured appropriately
    test: |
      (
      ntp_servers | tag_present('primary-ntp-server.ntp-server-address')
      and ntp_servers | tag_present('secondary-ntp-server.ntp-server-address')
      )
    fail_message: |
      Primary and Secondary NTP servers are not configured
    pass_message: Redundant NTP servers are configured
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html#device-setup-services-services

  # 1.6.3 Ensure that the Certificate Securing Remote Access VPNs is Valid
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: vpn_cert_valid
    label: 1.6.3 Ensure that the Certificate Securing Remote Access VPNs is Valid
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.1 Ensure that IP addresses are mapped to usernames
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: ip_addr_mapped_to_user
    label: 2.1 Ensure that IP addresses are mapped to usernames
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.2 Ensure that WMI probing is disabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: userid_probing
        capture_value: |
          /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/
          user-id-collector/setting/enable-probing/text()

  - name: wmi_probing_disabled
    label: 2.2 Ensure that WMI probing is disabled
    test: userid_probing != 'yes'
    fail_message: WMI probing is not disabled
    pass_message: WMI probing is disabled
    documentation_link: https://www.paloaltonetworks.com

  # 2.3 Ensure that User-ID is only enabled for internal trusted interfaces
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: userid_internal_zones_only
    label: 2.3 Ensure that User-ID is only enabled for internal trusted interfaces
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.4 Ensure that 'Include/Exclude Networks' is used if User-ID is enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: userid_with_include_exclude
    label: 2.4 Ensure that 'Include/Exclude Networks' is used if User-ID is enabled
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.5 Ensure that the User-ID Agent has minimal permissions if User-ID is enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: userid_agent_min_permissions
    label: 2.5 Ensure that the User-ID Agent has minimal permissions if User-ID is enabled
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.6 Ensure that the User-ID service account does not have interactive logon rights
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: userid_no_interactive_logon
    label: 2.6 Ensure that the User-ID service account does not have interactive logon rights
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.7 Ensure remote access capabilities for the User-ID service account are forbidden
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: userid_service_account
    label: 2.7 Ensure remote access capabilities for the User-ID service account are forbidden
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 2.8 Ensure that security policies restrict User-ID Agent traffic from crossing into untrusted zones
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: userid_agent_no_untrust_zone
    label: 2.8 Ensure that security policies restrict User-ID Agent traffic from crossing into untrusted zones
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 3.1 Ensure a fully-synchronized High Availability peer is configured
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: HA_peer_configured
    label: 3.1 Ensure a fully-synchronized High Availability peer is configured
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 3.2 Ensure 'High Availability' requires Link Monitoring and/or Path Monitoring
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: HA_link_path_monitoring
    label: 3.2 Ensure 'High Availability' requires Link Monitoring and/or Path Monitoring
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 3.3 Ensure 'Passive Link State' and 'Preemptive' are configured appropriately
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: HA_passive_link_preemptive
    label: 3.3 Ensure 'Passive Link State' and 'Preemptive' are configured appropriately
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 4.1 Ensure 'Antivirus Update Schedule' is set to download and install updates hourly
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: av_update_interval
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/
          update-schedule/anti-virus/recurring/*[1]
      - name: av_update_action
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/
          update-schedule/anti-virus/recurring/hourly/action/text()

  - name: AV_update_schedule
    label: 4.1 Ensure 'Antivirus Update Schedule' is set to download and install updates hourly
    test: |
      (
        av_update_interval == 'hourly'
        and av_update_action == 'download-and-install'
      )
    fail_message: |
      Antivirus Update Schedule is set to {{ av_update_interval }} with action {{ av_update_action }}
    pass_message: |
      Antivirus Update Schedule is set to {{ av_update_interval }} with action {{ av_update_action }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #ironskillet-dynamic-updates

  # 4.2 Ensure 'Applications and Threats Update Schedule'
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: threats_update_interval
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/
          update-schedule/threats/recurring/*[1]
      - name: threats_update_action
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/
          update-schedule/threats/recurring//action/text()

  - name: test_apps_threats_updates
    label: |
      4.2 Ensure 'Applications and Threats Update Schedule' is set to download and install updates
      at daily or shorter intervals
    test: |
      (
        threats_update_interval in app_threat_intervals
        and threats_update_action == 'download-and-install'
      )
    fail_message: |
     Applications and Threats Update Schedule is set to {{ threats_update_interval }}
     with action {{ threats_update_action }}
    pass_message: |
      Applications and Threats Update Schedule is set to {{ threats_update_interval }}
      with action {{ threats_update_action }}
    documentation_link: |-
      https://iron-skillet.readthedocs.io/en/docs_dev/viz_guide_panos.html
      #ironskillet-dynamic-updates

  # 5.1 Ensure that WildFire file size upload limits are maximized
  - name: wf_granular_parse
    cmd: parse
    variable: config
    outputs:
      - name: wf_limits_pe
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='pe']/size-limit/text()
      - name: wf_limits_apk
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='apk']/size-limit/text()
      - name: wf_limits_pdf
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='pdf']/size-limit/text()
      - name: wf_limits_msoffice
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='ms-office']/size-limit/text()
      - name: wf_limits_jar
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='jar']/size-limit/text()
      - name: wf_limits_flash
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='flash']/size-limit/text()
      - name: wf_limits_MacOSX
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='MacOSX']/size-limit/text()
      - name: wf_limits_archive
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='archive']/size-limit/text()
      - name: wf_limits_linux
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='linux']/size-limit/text()
      - name: wf_limits_script
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/wildfire/file-size-limit/
          entry[@name='script']/size-limit/text()

  # check all file types and sizes match BPA
  - name:  wf_limit_pe_test
    label: 5.1 Ensure that WildFire file size upload limits are maximized
    test: |-
      (
        wf_limits_pe | int >= wf_file_size_limits[0].pe | int
        and wf_limits_apk | int >= wf_file_size_limits[0].apk | int
        and wf_limits_pdf | int >= wf_file_size_limits[0].pdf | int
        and wf_limits_msoffice | int >= wf_file_size_limits[0]['ms-office'] | int
        and wf_limits_jar | int >= wf_file_size_limits[0].jar | int
        and wf_limits_flash | int >= wf_file_size_limits[0].flash | int
        and wf_limits_MacOSX | int >= wf_file_size_limits[0].MacOSX | int
        and wf_limits_archive | int >= wf_file_size_limits[0].archive | int
        and wf_limits_linux | int >= wf_file_size_limits[0].linux | int
        and wf_limits_script | int >= wf_file_size_limits[0].script | int
      )
    fail_message: |
      {%- if wf_limits_pe | int < wf_file_size_limits[0].pe | int %}
      pe file size should be configured as {{ wf_file_size_limits[0].pe }}
      {%- endif %}
      {%- if wf_limits_apk | int < wf_file_size_limits[0].apk | int %}
      apk file size should be configured as {{ wf_file_size_limits[0].apk }}
      {%- endif %}
      {%- if wf_limits_pdf | int < wf_file_size_limits[0].pdf | int %}
      pdf file size should be configured as {{ wf_file_size_limits[0].pdf }}
      {%- endif %}
      {%- if wf_limits_msoffice | int < wf_file_size_limits[0]['ms-office'] | int %}
      ms-office file size should be configured as {{ wf_file_size_limits[0]['msoffice'] }}
      {%- endif %}
      {%- if wf_limits_jar | int < wf_file_size_limits[0].jar | int %}
      jar file size should be configured as {{ wf_file_size_limits[0].jar }}
      {%- endif %}
      {%- if wf_limits_flash | int < wf_file_size_limits[0].flash | int %}
      flash file size should be configured as {{ wf_file_size_limits[0].flash }}
      {%- endif %}
      {%- if wf_limits_MacOSX | int < wf_file_size_limits[0].MacOSX | int %}
      MacOSX file size should be configured as {{ wf_file_size_limits[0].MacOSX }}
      {%- endif %}
      {%- if wf_limits_archive | int < wf_file_size_limits[0].archive | int %}
      archive file size should be configured as {{ wf_file_size_limits[0].archive }}
      {%- endif %}
      {%- if wf_limits_linux | int < wf_file_size_limits[0].linux | int %}
      linux file size should be configured as {{ wf_file_size_limits[0].linux }}
      {%- endif %}
      {%- if wf_limits_script | int < wf_file_size_limits[0].script | int %}
      script file size should be configured as {{ wf_file_size_limits[0].script }}
      {%- endif %}
    pass_message: |
      All Wildfire file types are set to max size
    documentation_link: www.paloaltonetworks.com

  # 5.2 Ensure forwarding is enabled for all applications and file types in WildFire file blocking profiles
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: WF_all_apps_files
    label: 5.2 Ensure forwarding is enabled for all applications and file types in WildFire file blocking profiles
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 5.3 Ensure a WildFire Analysis profile is enabled for all security policies
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      # filter down to get a list of security rules with a profile group not using WF analysis
      - name: security_rules
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/rulebase/security
          /rules/entry

      - name: profile_groups_with_wf_analysis
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/profile-group/entry/
          wildfire-analysis/member/../../@name

      - name: security_rules_with_profilegroup
        capture_expression: security_rules
        filter_items: |-
          item | tag_present('profile-setting.group')

      - name: security_rules_profilegroup_no_wf_object
        capture_expression: security_rules_with_profilegroup
        filter_items: |-
          item | element_value('profile-setting.group.member') not in profile_groups_with_wf_analysis

      - name: security_rules_profilegroup_no_wf
        capture_expression: security_rules_profilegroup_no_wf_object | map(attribute="entry.@name") | list

      # capture security rules using profiles yet without a WF profile
      - name: security_rules_with_wf_profile
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/rulebase/security
          /rules/entry/profile-setting/profiles/wildfire-analysis/member/../../../../@name

      - name: security_rules_without_wf_profile
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/rulebase/security
          /rules/entry/profile-setting/profiles/../../@name
        filter_items: item not in security_rules_with_wf_profile

  - name: WF_forward_decrypt_content
    label: 5.3 Ensure a WildFire Analysis profile is enabled for all security policies
    test: |-
      ( security_rules_profilegroup_no_wf | length == 0
        and security_rules_without_wf_profile | length == 0
      )
    fail_message: |-
      security rules violating this benchmark:
      {{ security_rules_profilegroup_no_wf }}
      {{ security_rules_without_wf_profile }}
    documentation_link: https://www.paloaltonetworks.com

  # 5.4 Ensure forwarding of decrypted content to WildFire is enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: allow_forward_decrypted_content
        capture_value: |-
          /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/setting/
          ssl-decrypt/allow-forward-decrypted-content/text()

  - name: WF_forward_decrypt_content
    label: 5.4 Ensure forwarding of decrypted content to WildFire is enabled
    test: allow_forward_decrypted_content == 'yes'
    fail_message: Forwarding of decrypted content is not enabled
    documentation_link: https://www.paloaltonetworks.com

  # 5.5 Ensure all WildFire session information settings are enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: wf_session_disabled_object
        capture_list: |-
          /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting/
          wildfire/session-info-select/*[text()='yes']

  - name: WF_session_info_enabled
    label: 5.5 Ensure all WildFire session information settings are enabled
    test: wf_session_disabled_object | length == 0
    fail_message: |-
      Session information settings not enabled:
      {%- for item in wf_session_disabled_object %}
        {%- for key in item %}
          {{ key }}
        {%- endfor %}
      {% endfor %}
    documentation_link: https://www.paloaltonetworks.com

  # 5.6 Ensure alerts are enabled for malicious files detected by WildFire
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: WF_alerts_malicious_files
    label: 5.6 Ensure alerts are enabled for malicious files detected by WildFire
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 5.7 Ensure 'WildFire Update Schedule' is set to download and install updates every minute
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: WF_update_schedule
    label: 5.7 Ensure 'WildFire Update Schedule' is set to download and install updates every minute
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.1 Ensure that antivirus profiles are set to block on all decoders except 'imap' and 'pop3'
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: AV_decoders_block
    label: 6.1 Ensure that antivirus profiles are set to block on all decoders except 'imap' and 'pop3'
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.2 Ensure a secure antivirus profile is applied to all relevant security policies
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: AV_profile_in_policies
    label: 6.2 Ensure a secure antivirus profile is applied to all relevant security policies
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.3 Ensure an anti-spyware profile is configured to block on all spyware severity levels, categories, and threats
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: spyware_profile_block_all
    label: 6.3 Ensure an anti-spyware profile is configured to block on all spyware severity levels, categories, and threats
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.4 Ensure DNS sinkholing is configured on all anti-spyware profiles in use
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: DNS_sinkhole_configured
    label: 6.4 Ensure DNS sinkholing is configured on all anti-spyware profiles in use
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.5 Ensure passive DNS monitoring is set to enabled on all anti-spyware profiles in use
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: enable_passive_DNS_monitoring
    label: 6.5 Ensure passive DNS monitoring is set to enabled on all anti-spyware profiles in use
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.6 Ensure a secure anti-spyware profile is applied to all security policies permitting traffic to the Internet
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: spyware_profile_in_policies
    label: 6.6 Ensure a secure anti-spyware profile is applied to all security policies permitting traffic to the Internet
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.7 Ensure a Vulnerability Protection Profile is set to block attacks against critical and high vulnerabilities,
  # and set to default on medium, low, and informational vulnerabilities
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: vulnerability_profile_blocking
    label: |
      6.7 Ensure a Vulnerability Protection Profile is set to block attacks against critical and high vulnerabilities,
      and set to default on medium, low, and informational vulnerabilities
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.8 Ensure a secure Vulnerability Protection Profile is applied to all security rules allowing traffic
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: vulnerability_profile_in_policies
    label: 6.8 Ensure a secure Vulnerability Protection Profile is applied to all security rules allowing traffic
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.9 Ensure that PAN-DB URL Filtering is used
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: pandb_url_filtering
    label: 6.9 Ensure that PAN-DB URL Filtering is used
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.10 Ensure that URL Filtering uses the action of “block” or “override” on the URL categories
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: url_filtering_block_or_override
    label: 6.10 Ensure that URL Filtering uses the action of “block” or “override” on the URL categories
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.11 Ensure that access to every URL is logged
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: url_filtering_log_all_categories
    label: 6.11 Ensure that access to every URL is logged
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.12 Ensure all HTTP Header Logging options are enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: url_filtering_http_header_logging
    label: 6.12 Ensure all HTTP Header Logging options are enabled
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.13 Ensure secure URL filtering is enabled for all security policies allowing traffic to the Internet
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: url_filtering_all_policies
    label: 6.13 Ensure secure URL filtering is enabled for all security policies allowing traffic to the Internet
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.14 Ensure alerting after a threshold of credit card or Social Security numbers is detected is enabled
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: data_filtering_cc_ss_numbers
    label: 6.14 Ensure alerting after a threshold of credit card or Social Security numbers is detected is enabled
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.15 Ensure a secure Data Filtering profile is applied to all security policies allowing traffic to or from the Internet
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: data_filtering_profile_in_policies
    label: 6.15 Ensure a secure Data Filtering profile is applied to all security policies allowing traffic to or from the Internet
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.16 Ensure that a Zone Protection Profile with an enabled SYN Flood Action of SYN Cookies is attached to all untrusted zones
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: zone_protect_syn_flood
    label: 6.16 Ensure that a Zone Protection Profile with an enabled SYN Flood Action of SYN Cookies is attached to all untrusted zones
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.17 Ensure that a Zone Protection Profile with tuned Flood Protection settings enabled for all flood types is attached to all untrusted zones
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: zone_protect_flood_protect
    label: 6.17 Ensure that a Zone Protection Profile with tuned Flood Protection settings enabled for all flood types is attached to all untrusted zones
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.18 Ensure that all zones have Zone Protection Profiles with all Reconnaissance Protection settings enabled, tuned, and set to appropriate actions
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: zone_protection_reconn_protect
    label: 6.18 Ensure that all zones have Zone Protection Profiles with all Reconnaissance Protection settings enabled, tuned, and set to appropriate actions
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.19 Ensure all zones have Zone Protection Profiles that drop specially crafted packets
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: zone_protect_crafted_pkts
    label: 6.19 Ensure all zones have Zone Protection Profiles that drop specially crafted packets
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 6.20 Ensure that User Credential Submission uses the action of “block” or “continue” on the URL categories
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: user_cred_block_continue
    label: 6.20 Ensure that User Credential Submission uses the action of “block” or “continue” on the URL categories
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 7.1 Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: app_security_more_trusted_zone
    label: 7.1 Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 7.2 Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: service_any_not_allowed_in_policy
    label: 7.2 Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 7.3 Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: security_policy_deny_threat_ips
    label: 7.3 Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 8.1 Ensure 'SSL Forward Proxy Policy' for traffic destined to the Internet is configured
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: ssl_forward_proxy_policy
    label: 8.1 Ensure 'SSL Forward Proxy Policy' for traffic destined to the Internet is configured
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 8.2 Ensure 'SSL Inbound Inspection' is required for all untrusted traffic destined for servers using SSL or TLS
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: ssl_inbound_inspection
    label: 8.2 Ensure 'SSL Inbound Inspection' is required for all untrusted traffic destined for servers using SSL or TLS
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com

  # 8.3 Ensure that the Certificate used for Decryption is Trusted
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting

  - name: decrypt_cert_trusted
    label: 8.3 Ensure that the Certificate used for Decryption is Trusted
    test: false
    fail_message: test is not implemented
    documentation_link: https://www.paloaltonetworks.com
